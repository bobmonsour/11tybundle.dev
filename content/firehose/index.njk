<header class="main-header">
  <div class="container">
    <h1>Firehose <data class="count" value="{{ bundledata.postCount }}">{{ bundledata.postCount | singleComma }}</data></h1>
    <nav>
      <ul role="list">
        <li><a href="/firehose" class="current">Posts</a></li>
        <li><a href="/firehosefeed.xml">RSS</a></li>
      </ul>
    </nav>
  </div>
</header>
<nav class="section">
  <div class="container">
    <ul role="list" id="skip-links-years" class="skip-links">
      {% for year in bundledata.firehose | postYearsInFirehose %}
        <li><a href="#y-{{ year }}">{{ year }}</a></li>
      {% endfor %}
    </ul>
  </div>
</nav>

{# Placed here, but referenced in button below #}
<div id="info" popover>We get it—not everyone knows what a firehose is. In computing, a firehose is an unfiltered, real-time stream of data. On the 11ty Bundle, it means everything added to the website across all categories, shown in reverse date order—most recent first. Fill your boots!
</div>


<div class="section">
  <div class="container">
    {# button reveals popover with text from above div with id="info" #}
    <button popovertarget="info" class="button--transparent">
      <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
        <use xlink:href="#icon-info"></use>
      </svg> About the firehose
    </button>

{% set newestPost = bundledata.firehose | first %}
{% set newestPostYear = newestPost.Date | truncate(4, true, '') %}
{% set current_year = newestPostYear %}
{% set previous_year = current_year %}


    <details name="details" class="directory__layout"  {% if current_year == newestPostYear %}open{% endif %}>
      <summary id="y-{{ current_year }}"><h2>{{ current_year }}</h2></summary>
      <div class="directory__grid">
      {% for item in bundledata.firehose %}
    	{% set current_year = item.Date | truncate(4, true, '') %}
      {% if (current_year != previous_year) %}
      {# on year change, close the previous year's related tags #}
      </div>
    </details>
  </div>
</div>
      {% set previous_year = current_year %}
<div class="section">
  <div class="container">
    <details name="details" class="directory__layout">
      <summary id="y-{{ current_year }}"><h2>{{ current_year }}{%-include "partials/release-check.njk"-%}</h2></summary>
      <div class="directory__grid">
    {% endif %}

        <div class="directory__card directory--detail">
          {{ item.favicon | safe }}<a href="{{ item.Link }}">{{ item.Title }}</a>
          <div class="details">
            <p>{{ item.description | safe }}</p>
            <time datetime="{{ item.Date | formatYMD }}">{{ item.formattedDate }}</time>
            {%- set authorRecord = bundledata.authors | getAuthorRecord(item.Author) -%}
            <p>By <a href="/authors/{{ item.slugifiedAuthor }}">{{ item.Author }}</a> ({{ authorRecord.count | countLabel("post") }})</p>
            <ul role="list" class="author-links">
              {{ authorRecord.origin | getAuthorIcons | safe }}
            </ul>
            <div class="categories-list">
              <strong>Categories</strong>
              <ul role="list">
                {% for category in item.Categories %}
                  <li><a href="/categories/{{ category | slugify }}/">{{ category }}</a></li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
    </details>
  </div>
</div>
{% include "partials/releasepopovers.njk" %}
